---
title: "Supplementary Information: Drought sensitivity is not a species trait: Tropical tree drought sensitivity is jointly shaped by drought characteristics, species adaptations, and individual microenvironments"
author: 
date: 
output: 
  pdf_document:
    fig_caption: yes
    toc: true # table of content true
    toc_depth: 2  
bibliography: growth-precip-thailand.bib
suppress-bibliography: false
csl: new-phytologist.csl
header-includes:  \usepackage{float}
                  \usepackage{caption}
                  \captionsetup[table]{font=footnotesize}
                  \captionsetup[figure]{labelformat=empty}
                  \captionsetup[table]{labelformat=empty}
                  \usepackage{pdflscape}
                  \newcommand{\blandscape}{\begin{landscape}}
                  \newcommand{\elandscape}{\end{landscape}}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Appendices

# SI table numbers

# SI table captions

# SI figure numbers

# SI figure captions


# https://github.com/EcoClimLab/Operations/blob/master/Data_Management-Scientific_Workflow/manuscript_prep_with_Rmd.md
```

**Authors**  
```{r eval = TRUE, echo=FALSE, warning=FALSE}
# library(flextable)
# set_flextable_defaults(font.family = "Arial", font.size = 9)
team <- read.csv("display/authors.csv", stringsAsFactors = FALSE, check.names = FALSE)

# team <- read.csv("doc/display/authors.csv", stringsAsFactors = FALSE, check.names = FALSE)

# ft <- flextable(team)
# ft <- line_spacing(ft, space = 1, part = "all")
# ft <- autofit(ft)
# ft <- width(ft, 1, width = 1.75)
# ft <- width(ft, 2, width = 1.75)
# ft <- width(ft, 3, width = 3)
# ft
```

Krishna Anujan^1,2^*  ORCiD: `r team$ORCID[1]`  
Sean McMahon^2,3^  ORCiD: `r team$ORCID[2]`  
Sarayudh Bunyavejchewin^4^  ORCiD: `r team$ORCID[3]`  
Stuart J. Davies^3^  ORCiD: `r team$ORCID[4]`  
Helene C. Muller-Landau^3^  ORCiD : `r team$ORCID[5]`  
Nantachai Pongpattananurak^5^  ORCiD: `r team$ORCID[6]`  
Kristina Anderson-Teixeira^1,3^  ORCiD: `r team$ORCID[7]`  


```{r read files, echo=F}
# Read in files

# figure numbers


# figure titles
```

\newpage

## Study site

![**Figure S1:** Representative photographs of the 50-ha long-term monitoring site in Huai Kha Khaeng Thailand, with dendrometer banded trees. Photo credits: left image: Sarayudh Bunyavejchewin, right image: Krishna Anujan](display/site_photos.png)


\newpage

## Climate data and correlations

![**Figure S2:** Raw climate data timeseries from 2009 to 2023 from ERA5Land and CHIRPS. Measurements represent daily rolling means over a 30-day time window for precipitation, max temperature and VPD and rolling sum for number of dry days. The shaded areas indicate the three drought years analysed - 2010, 2015 and 2020. Dry-season in the region is typically from November to April.](display/climvars_fullseries_remote.png)

![**Figure S3:** Climate anomalies for all variables from 2009 to 2020. Values represent number of standard deviations from the long-term mean for daily rolling mean values. The shaded areas indicate the three drought years analysed - 2010, 2015 and 2020.Dry-season in the region is typically from November to April.](display/climvars_anomalies_fullseries_remote.png)

\newpage

## Data cleaning additional methods

<!-- - Data cleaning steps -->
For raw measurements of dendrometer band window size, we conducted QAQC steps as follows:
1. Removed potentially misidentified individuals. We removed individuals with conflicting metadata on tag or location across censuses. We did not remove individuals with conflicting species identification because these are often updated during the ForestGEO censuses. Therefore, we used the latest version of species identification for each tag shared by the PIs of the HKK plot.
2. Removed potential misidentified bands. Each new dendroband installed on a tree is numbered sequentially starting from 1. We removed any measurements made on bands old bands after a new band series had begun. 
3. Removing measurements that appeared likely to be data entry errors. We identified misplaced decimals by checking if the ratio between adjacent window size measurements were closer to 1 or 10 or 100. We removed measurements that had ratios closer to 10 or 100 than 1, assuming that these were likely misplaced decimals.

After calculating DBH from window size measurements and calculating annualised growth increments, we conducted further QAQC on these increments to create the final dataset:
1. We excluded large measurement outliers, defined as > 3 standard deviations from the mean increment across all observations. 
2. We excluded trees with negative increments or increments close to zero over the whole timeseries of observations. These low growing trees may be indicative of stress or mortality, and likely to bias analysis of interannual growth variation. 
3. We used concurrent tape measurements on dendrobanded trees to flag likely errors. We calculated annualised increments from annual tape measurements made on each dendrobanded tree at each census, using similar methods as described for dendrometer bands. For each tree and year, we calculated the degree of deviation of these measurements from each other as the Euclidean distance from the 1:1 line. We found that 90% of the increments were within 5 mm of of deviation, which we retained as a high confidence dataset. We excluded the remaining 10% from the analysis, although we were unable to ascertain whether the discrepancy was because of errors in tape or dendroband measurements. 

\newpage

## Growth timeseries and anomalies

![**Figure S4:** Growth anomalies across the timeseries. Growth anomalies for each year calculated as the number of standard deviations in growth each year from mean growth across all years and summarised for plot and species.](display/growth_anom_fullseries.png)

<!-- ![Fig S4: Proportion of negative growth increments](display/neg_incs.png) -->

\newpage

## Drought year growth of species and individuals

![**Figure S5:** Species sensitivities in drought years 2010, 2015 and 2020. Boxplots represent 25th, 50th (median) and 75th percentile of sensitivity for each species in each year and whiskers represent 95% CIs. All individual sensitivities represented by jittered points.](display/Fig_SI_species_sensitivities.png)

![**Figure S6:** Correlations of species sensitivities across the two years. The top-left panel shows correlation of species median sensitivities and Pearson's correlation coefficient in the 2010 and 2015, top right shows 2010 and 2020, and bottom left shows 2015 and 2020. Colour gradient represents deciduousness scale and dotted line is the 1:1 line. The bottom right panel shows how species drought sensitivites varies among the three years; the color scheme for droughts matches that in main text figure 1.](display/Fig_SI_sensitivity_cor_dec.png)

<!-- ![](display/Fig_trait_intercept_plot.png) -->

![**Figure S7:** Correlation of individual sensitivities across the two years along with Pearson's correlation coefficient and the 1:1 line.](display/sens_corr.png)

**Table S1: Species characteristics and their median sensitivities** for the three drought years. Species characteristics reported include accepted scientific names of species analysed, their ForestGEO codes, deciduousness values (amount of leaf loss at maximum) and IUCN status as accessed in September 2025. For each species, median growth sensitivity +/- standard deviation is reported across the individuals analysed in 2010, 2015, and 2020 - the three drought years considered. IUCN category codes - "EN" = Endangered, "VU" = Vulnerable, "LC" = Least Concern, "DD" = Data Deficient. Empty columns indicate species which were not part of the IUCN assessment. 

```{r summary table, echo=F, warning=F, message=F}
library(tidyverse)
datasets <- readRDS("../data/HKK-dendro/sensitivity_data.RData")

tree.time <- datasets$tree.time
tree_vars <- datasets$tree_vars
sp_vars <- datasets$sp_vars

sp_new <- read.csv("../data/HKK-dendro/species.csv")

colnames(sp_vars)[1] <- "Species"
sp_vars$iucn <- sp_new$iucn[match(sp_vars$Species, sp_new$sp)]

# merge tree_vars and sp_vars
tree_vars <- merge(tree_vars, sp_vars, by = "Species", all.x = TRUE)
# merge tree_vars and tree.time
tree.time <- merge(tree.time, tree_vars, by = "Tag", all.x = TRUE)

# colnames(tree.time)

# standardise the variables within species and across all--------------------

tree.time <- tree.time %>%
  # remove large outliers for each year
  group_by(yr) %>%
  dplyr::mutate(sens.prop = ifelse(mean(sens.prop, na.rm = TRUE) + 4 * sd(sens.prop, na.rm = TRUE) > sens.prop & sens.prop > mean(sens.prop, na.rm = TRUE) - 4 * sd(sens.prop, na.rm = TRUE), sens.prop, NA)) %>%
  filter(!is.na(sens.prop) & !is.na(cii_min1) & !is.na(calcDBH_min1) & !is.na(twi)) %>%
  ungroup()

# make a species table for each year

sens_sp <- tree.time %>%
  filter(yr %in% c(2010, 2015, 2020)) %>%
  group_by(spfull, yr) %>%
  dplyr::summarise(
    n = n(),
    med_sens = round(median(sens.prop, na.rm = T), 2),
    sd_sens = round(sd(sens.prop, na.rm = T), 2)
  ) %>%
  ungroup()

sens_sp <- merge(sens_sp, dplyr::select(sp_vars, c(spfull, Species, williams_dec, iucn)), by = "spfull", all.x = T)

# head(sens_sp)
# make the column
sens_sp$sens <- paste0(sens_sp$med_sens, " +/- ", sens_sp$sd_sens)

# pivot wider by year

sens_sp <- sens_sp %>%
  dplyr::select(-med_sens, -sd_sens, -n) %>%
  pivot_wider(values_from = sens, names_from = yr) %>%
  dplyr::rename(
    deciduousness = williams_dec,
    "IUCN status" = iucn,
    "Species name" = spfull,
    "Species code" = Species
  )
# head(sens_sp)

knitr::kable(sens_sp)
```

\newpage

## Variables and their distributions

Map of trees

![**Figure S8:** Map of trees with dendrobands in HKK, included in analyses in the 2010, 2015 and 2020 datasets](display/dendro_tree_map.png)

![**Figure S9:** Calculated Topographic Wetness Index (TWI) values for the HKK plot](display/twi.png)

![**Figure S10:** Distribution of DBH with Crown Illumination Index (CII) in 2014.](display/dbh_cii.png)


\newpage

## Raw sensitivity and residuals with predictors

![**Figure S11:** Distribution of raw sensitivity values across years and their relationship with DBH, CII and TWI. Blue lines are linear model fits for statistically significant relationships at p<0.05. Red lines are Friedman's SuperSmoother fits for all.](display/sens_var_rels.png)

![**Figure S12:** Distribution of residuals of species intercept models of sensitivity and their relationship with scaled DBH, TWI and CII and deciduousness. Grey lines are linear model fits for statistically significant relationships at p<0.05. Species intercept model results are reported in main text.](display/residuals.png)


\newpage

## Conditional dependencies 

To analyse the influence of microenvironmental variables on growth sensitivity, we first created a Directed Acyclic Graph describing the relationships. 
The consistency of the DAG with the dataset, and our ability build causally interpretable models, is conditional on the numerical independence among some specific variable groups, as implied by the DAG structure.
We identified these "testable implications" or "conditional independences" for this DAG using *dagitty* as CII $\perp\!\!\!\perp$ TWI and DBH $\perp\!\!\!\perp$ TWI.
We tested these correlations using the function *cor()* in R, with the simple criteria that a Pearson's correlation coefficient <0.3 implies independence among variable pairs and causal relevance of the DAG. 

![**Figure S13:** Testing correlations of variables across all individuals](display/cond_dep_alltrees.png)  

There is low correlation between these two variable pairs across all individuals. We then tested conditional dependencies at the species level.

![**Figure S14:** Testing correlations for DBH $\perp\!\!\!\perp$ TWI by species](display/cond_dep_dbh_twi.png)  

![**Figure S15:** Testing correlations for CII $\perp\!\!\!\perp$ TWI by species](display/cond_dep_cii_twi.png)
 
Most species (barring a few) had low correlation between these variables in our dataset, allowing us to proceed with analysis and interpretation.


\newpage

## Alternate models using Topographic Position Index

As an alternate measure of wetness to Topographic Wetness Index (TWI) that requires the total upslope area, we used Topographic Position Index (TPI), a localised convexity/concavity-based metric of water availability as a predictor.
We calculated TPI using the package *spatialEco* [@evans_spatialeco_2023] using a circular buffer window of 1, 3, 5 and 7 pixels. 
Larger window sizes while providing a smoother surface on the plot, clip out larger portions of the plot margin where the window might bleed outside. 
We chose to use the 5-pixel version because of the balance between smoothness across the landscape and data loss.  

TPI and TWI had better resolution in different parts of the wetness gradient, with TWI capturing larger resolution among wetter locations and TPI capturing larger resolution among drier locations. 
Interaction models of deciduousness with TPI showed qualitatively similar results with the TWI models across the three drought years.

![**Figure S16:** Correlation of modelled species sensitivities with Topographic Position Index](display/FigSI_TPI_preds.png)

Similarly, models accounting for DBH and CII showed similar directional effects of wetness whether TWI or TPI was used. 
Please note that left to right represents wet to dry, given the way that TPI is calculated.

![**Figure S17:** Model results from Bayesian causal model of sensitivity as a function of DBH, CII and TPI.](display/Fig4_tpi_3yrs.png)

\newpage

# Alternate model using species random effect only on intercept

![**Figure S18:** Model results from Bayesian causal model of sensitivity as a function of DBH, CII and TWI with species random effect only on intercept.](display/FigSI_coefs_nospre.png)

\newpage

# Alternate models as causal inquiries following backdoor criteria

For an alterate approach, we used a backdoor criteria approach as used in causal inquiry to test the effects of DBH, CII and TWI on sensitivity separately starting from a combined DAG. 
First, we specificied the DAG on DAGitty [@textor_robust_2016] in the same strcuture as described in Fig 5 in the main text.
We then set sensitivity as the response variable, or "outcome".
For each variable - DBH, CII and TWI - whose causal effects we were interested in, we examined the minimum set of adjustment variables for each causal effect, by setting each of these as "exposure" one after the other and computing adjustment sets from DAGitty.
This resulted in three different models to test the total causal effects:

For TWI: $sensitivity \sim TWI$  
For CII: $sensitivity \sim CII$  
For DBH: $sensitivity \sim DBH + CII$

We fit three different models on *brms*, with normal priors for sensitivity, TWI and DBH and a monotonic prior for CII.
All models had a random effect of Species on both slopes and intercept. 
Results from the causal inquiries following backdoor criteria align very closely with the SEM-like Bayesian causal model.

![**Figure S19:** Model results from three independent causal inquiry models of sensitivity following backdoor criteria for total causal effect of DBH, CII and TWI with species random effect on intercept and slope.](display/causal_inquiry.png)

<!-- ## Individual model diagnostics

To add: 

\newpage -->

<!-- ## Growth occurrence models

To add: zero growth models -->

# References {-}